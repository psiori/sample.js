/*!
 * Sample.js - Sends tracking events to 5d's analytics service. v0.0.7
 * http://www.5dlab.com
 *
 * Copyright (c) 2014-2016, Sascha Lange, Jo√£o Alves, Daniel Band, Artur Susdorf, Jonas Kindler
 * Licensed under the MIT License.
 *
 */

!function(a){var b=function(a){return"undefined"!=typeof Array.isArray?Array.isArray(a):"[object Array]"===Object.prototype.toString.call(a)},c=function(a,b,c){return c+"["+a+"]="+encodeURIComponent(b)},d=function(a,b){var d=[];for(var e in a)a.hasOwnProperty(e)&&(d[d.length]=c(e,a[e],b));return d},e=function(a,b){for(var c=[],e=0;e<a.length;e++)c[c.length]=d(a[e],b+"["+e+"]").join("&");return c},f=function(){return navigator.userAgent.match(/PhantomJS/)||navigator.onLine},g=function(){var a=function(a,b,c,d){if(d){var e={status:b.status,headers:b.getResponseHeader,url:c},f={};try{f=JSON.parse(b.responseText)}catch(g){}d(f,e)}},b=function(a,b,c,d){if(d){var e={status:b.status,headers:b.getResponseHeader,url:c},f={};try{f=JSON.parse(b.responseText)}catch(g){}d(f,e)}},c={send:function(c,d,e,f){var g=JSON.stringify(d),h=new XMLHttpRequest;h.addEventListener("load",function(d){200!==h.status&&201!==h.status?a(d,h,c,f):b(d,h,c,e)},!0),h.addEventListener("error",function(b){a(b,h,c,f)}),h.open("POST",c),h.setRequestHeader("Content-type","application/json; charset=utf-8"),h.send(g)}};return c}(),h=function(){var a=9900,c="sample-js-iframes",f=function(b,d){function e(){d&&d(),f.removeChild(h)}var f=document.getElementById(c);if(!f){var g=document.getElementsByTagName("body")[0];f=document.createElement("div"),f.id=c,f.style.display="none",f.style.width="0",f.style.height="0",f.style.margin="0",g.insertBefore(f,g.childNodes[0])}var h=document.createElement("iframe"),i="sample-key-"+a++;h.onload=e,h.onerror=e,h.src=b,h.id=i,h.style.position="fixed",h.style.width="1px",h.style.height="1px",h.style.border="0",h.style.margin="0",h.style.padding="0",h.style.left="0",h.style.top="0",f.appendChild(h)},g={send:function(a,c,g){var h="";b(c.p)?h=e(c.p,"p").join("&"):"object"==typeof c.p&&(h=d(c.p,"p").join("&")),a+=-1===a.indexOf("?")?"?"+h:"&"+h,f(a,g)}};return g}(),i=function(){return{callback:function(){},events:[]}},j=function(){var a=[],b=i(),c=!1,d=!1,e=null,j=!1,k=500,l=6e4,m=0,n={useXHR:!0,start:function(){d||(d=!0,e=setInterval(function(){n.sendNext()},5e3))},stop:function(){d&&(d=!1,clearInterval(e))},isRunning:function(){return d===!0},setRequestMethod:function(a){this.useXHR="xhr"===a},length:function(){return a.length},isEmpty:function(){return 0===a.length},isSending:function(){return c===!0},startGroup:function(){j=!0},endGroup:function(){var a=b;j=!1,0!==b.events.length&&(b=i(),this.add(a.url,a.events,a.callback))},isGroup:function(){return j},add:function(c,d,e){if(j){if(e){var f=b.callback;b.callback=function(){e.apply(this,arguments),f.apply(this,arguments)}}b.events[b.events.length]=d,b.url=c}else a[a.length]={event:d,callback:e,url:c},this.sendNext()},clear:function(){a=[]},sendNext:function(){if(d&&f()&&!c&&!this.isEmpty()){c=!0;var b=a[0],e=this,i=b.url,j={p:b.event},n=function(d,f){a.shift(),m=0,c=!1,e.sendNext(),"function"==typeof b.callback&&b.callback.call(b.callback,d,f)},o=function(d,f){c=!1,m+=1,400===f.status||500===f.status?(a.shift(),e.sendNext(),"function"==typeof b.callback&&b.callback.call(b.callback,d,f)):setTimeout(function(){e.sendNext()},Math.min(k*m,l))};this.useXHR?g.send(i,j,n,o):h.send(i,j,n,o)}}};return document.addEventListener("online",function(){n.sendNext()}),document.addEventListener("offline",function(){}),n.start(),n}(),k=function(){var a=location.protocol||"https:";return"http:"!==a&&"https:"!==a&&(a="https:"),a},l=k()+"//events.psiori.com/sample/v01/event",m="Sample.JS",n="0.0.7",o=null,p=null,q=null,r=null,s=null,t=null,u=null,v=null,w=null,x=null,y=null,z=null,A=null,B=null,C=null,D=null,E=null,F=null,G=null,H=null,I=null,J=!0,K=!1,L=!1,M=!0,N=null,O=!1,P=null,Q=function(b,c){c=c||"sessionStorage";try{if("undefined"!=typeof a[c])return a[c].getItem(b)}catch(d){}return null},R=function(b,c,d){d=d||"sessionStorage";try{if("undefined"!=typeof a[d])return a[d].setItem(b,c),a[d].getItem(b)}catch(e){}return null},S=function(b,c){c=c||"sessionStorage";try{"undefined"!=typeof a[c]&&a[c].removeItem(b)}catch(d){}return null},T=function(a){for(var b={},c=a.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");2===e.length&&(b[e[0].toLowerCase()]=decodeURIComponent(e[1]))}return b},U=function(a){return H=a,R("page_id",a)},V=function(){return Q("page_id")||H||null},W=function(){H=null,S("page_id")},X=function(b,c,d){var e={},f=function(a,b){a&&"undefined"!=typeof b&&("number"==typeof b||b)&&(e[a]=b)};if(f("sdk",m),f("sdk_version",n),f("platform",b.platform||u),f("client",b.client||v),f("client_version",b.client_version||w),f("event_name",c),f("app_token",p),f("install_token",o),f("session_token",q),f("debug",K),f("force_date",L),f("timestamp",b.timestamp||I||Math.round((new Date).getTime()/1e3)),f("user_id",s),f("event_category",d||"custom"),f("module",b.module||r),f("content_id",b.content_id),f("content_ids",b.content_ids),f("content_type",b.content_type),f("page_id",b.page_id||V()),f("translation",b.translation),f("parameter1",b.parameter1),f("parameter2",b.parameter2),f("parameter3",b.parameter3),f("parameter4",b.parameter4),f("parameter5",b.parameter5),f("parameter6",b.parameter6),f("callback",b.callback),f("automatic",b.automatic),("purchase"===c||"chargeback"===c)&&(f("pur_provider",b.pur_provider),f("pur_gross",b.pur_gross),f("pur_currency",b.pur_currency),f("pur_country_code",b.pur_country_code),f("pur_earnings",b.pur_earnings),f("pur_product_sku",b.pur_product_sku),f("pur_product_category",b.pur_product_category),f("pur_receipt_identifier",b.pur_receipt_identifier)),"session_start"===c||"session_update"===c||"session_resume"===c||d&&"account"===d){if(f("email",b.email||t),f("locale",b.locale||C),!b.ad_referer&&!z&&M&&a.location&&a.location.search){var g=T(a.location.search.substring(1));z=g.refid||g.ref_id||null,A=g.subid||g.sub_id||null,B=g.placeid||g.place_id||null}f("ad_referer",b.ad_referer||z),f("ad_campaign",b.ad_campaign||A),f("ad_placement",b.ad_placement||B),f("longitute",b.longitude||x),f("latitude",b.latitude||y),f("country_code",b.country_code||G),f("facebook_id",b.facebook_id||F),f("target_group",b.target_group),J&&(f("http_referrer",document.referrer),f("http_request",a.location.href)),f("host",E||(J?a.location.host:null))}return"custom"===d&&f("acc_value",b.acc_value||N),e},Y=function(a,b,c){document.cookie=encodeURIComponent(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(c?"; domain="+c:"")+(b?"; path="+b:"")},Z=function(a){var b=new Date;b.setTime(b.getTime()+15552e6),document.cookie="psi="+a+"; expires="+b.toUTCString()+(P?"; domain="+P:"")+"; path=/"},$=function(){for(var a="psi=",b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "===d.charAt(0);)d=d.substring(1,d.length);if(0===d.indexOf(a))return d.substring(a.length,d.length)}return null},_=function(){var a="undefined"!=typeof navigator.cookieEnabled&&!navigator.cookieEnabled;return a||(document.cookie="_psi",a=-1!==document.cookie.indexOf("_psi")?!1:!0,a||Y("_psi")),!a},ab=function(a){for(var b="",c=0;a>c;++c)c>0&&c%4===0&&(b+="-"),b+=Math.floor(16*Math.random()).toString(16).toUpperCase();return b},bb={PLATFORM_BROWSER:"browser",PLATFORM_IOS:"ios",PLATFORM_ANDROID:"android",PLATFORM_WINDOWS:"windows",PLATFORM_FACEBOOK:"facebook",init:function(){O=_(),P="undefined"==typeof a.Sample?null:bb.DOMAIN||null,O?((o=$())||(o=ab(24)),Z(o),R("SampleToken",o,"localStorage")):(o=Q("SampleToken","localStorage"))||R("SampleToken",o=ab(24),"localStorage"),(q=Q("SampleToken","sessionStorage"))||R("SampleToken",q=ab(32),"sessionStorage"),u=this.PLATFORM_BROWSER,j.setRequestMethod("xhr")},stop:function(){j.stop()},resume:function(){j.start()},setEndpoint:function(a){l=a},getEndpoint:function(){return l},setRequestMethod:function(a){j.setRequestMethod(a)},setAppToken:function(a){p=a},setAutoExtractCampaign:function(a){M=a},setModule:function(a){r=a},setPlatform:function(a){u=a},getPlatform:function(){return u},setClient:function(a){v=a},setClientVersion:function(a){w=a},setUserId:function(a){s=a},setFacebookId:function(a){F=a},setEmail:function(a){t=a},setLocation:function(a,b){x=newLogitude,y=b},setLocale:function(a){C=a},setReferer:function(a,b,c){z=a||null,A=b||null,B=c||null},setDebug:function(a){K=a},setForceDate:function(a){L=a},setTimestamp:function(a){I=a?Math.round(a.getTime()/1e3):null},setBrowserMode:function(a){inBrowser=!!a},setHost:function(a){E=a},setInstallToken:function(a){o=a,O&&Z(o),R("SampleToken",o=a,"localStorage")},installToken:function(){return o},setSessionToken:function(a){R("SampleToken",q=a,"sessionStorage")},sessionToken:function(){return q},startGroup:function(){j.startGroup()},endGroup:function(){j.endGroup()},track:function(a,b,c){c=X(c||{},a,b),j.add(l,c,c.callback)},sessionStart:function(a,b,c){p=a||p,s=b||s,this.pageEnd({automatic:!0}),this.track("session_start","session",c)},sessionUpdate:function(a){this.track("session_update","session",a)},sessionPause:function(){this.track("session_pause","session")},sessionResume:function(){this.track("session_resume","session")},ping:function(){this.track("ping","session")},autoPing:function(a){var b=this;"undefined"==typeof a&&(a=60),clearTimeout(D),D=null,a&&a>0&&(D=setInterval(function(){b.ping()},1e3*a))},registration:function(a,b){s=a||s,this.track("registration","account",b)},signIn:function(a,b){s=a||s,this.track("sign_in","account",b)},profileUpdate:function(a){this.track("update","account",a)},contentView:function(a,c,d){d=d||{},d.content_type=c||d.content_type||"content",b(a)?d.content_ids=a:d.content_id=a,this.track("view","content",d)},contentUsage:function(a,c,d){d=d||{},d.content_type=c||d.content_type||"content",b(a)?d.content_ids=a:d.content_id=a,this.track("usage","content",d)},pageView:function(a,b){b=b||{},b.content_type="page",b.page_id=a,this.track("view","content",b)},pageStart:function(a,b){this.pageEnd({automatic:!0}),U(a),this.pageView(a,b)},pageEnd:function(a){var b=V();b&&(a=a||{},a.page_id=b,a.content_type="page",this.track("view-end","content",a),W())},purchase:function(a,b){var c=b||{};c.pur_product_sku=a,this.track("purchase","revenue",c)},chargeback:function(a,b){var c=b||{};c.product_sku=a,this.track("chargeback","revenue",c)},isWebkit:function(){var a=null;return function(){if(null===a){var b=navigator.userAgent.toLowerCase();a=-1!==b.indexOf("safari")||-1!==b.indexOf("chrome")}return a}}(),isIE:function(){var a=null;return function(){if(null===a){var b=navigator.userAgent;a=-1!==b.indexOf("MSIE")||b.indexOf("Trident/")>0}return a}}(),customEvent:function(a,b){var c=b||{};this.track(a,"custom",c)}};bb.init(),a.Sample=bb}(window);
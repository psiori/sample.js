/*!
 * Sample.js - Sends tracking events to 5d's analytics service. v0.0.2
 * http://www.5dlab.com
 *
 * Copyright (c) 2014-2014, Sascha Lange, Jo√£o Alves
 * Licensed under the MIT License.
 *
 */

!function(a){var b=function(a){return"undefined"!=typeof Array.isArray?Array.isArray(a):"[object Array]"===Object.prototype.toString.call(a)},c=function(a,b,c){return c+"["+a+"]="+encodeURIComponent(b)},d=function(a,b){var d=[];for(var e in a)a.hasOwnProperty(e)&&(d[d.length]=c(e,a[e],b));return d},e=function(a,b){for(var c=[],e=0;e<a.length;e++)c[c.length]=d(a[e],b+"["+e+"]").join("&");return c},f=function(){var a={send:function(a,b,c,d){var e=JSON.stringify(b),f=new XMLHttpRequest;f.addEventListener("load",function(){c&&c()},!0),f.addEventListener("error",function(){d&&d()}),f.open("POST",a),f.setRequestHeader("Content-type","application/json; charset=utf-8"),f.send(e)}};return a}(),g=function(){var a=9900,c="sample-js-iframes",f=function(b,d){function e(){d&&d(),f.removeChild(h)}var f=document.getElementById(c);if(!f){var g=document.getElementsByTagName("body")[0];f=document.createElement("div"),f.id=c,f.style.display="none",f.style.width="0",f.style.height="0",f.style.margin="0",g.insertBefore(f,g.childNodes[0])}var h=document.createElement("iframe"),i="sample-key-"+a++;h.onload=e,h.onerror=e,h.src=b,h.id=i,h.style.position="fixed",h.style.width="1px",h.style.height="1px",h.style.border="0",h.style.margin="0",h.style.padding="0",h.style.left="0",h.style.top="0",f.appendChild(h)},g={send:function(a,c,g){var h="";b(c.p)?h=e(c.p,"p").join("&"):"object"==typeof c.p&&(h=d(c.p,"p").join("&")),a+=-1===a.indexOf("?")?"?"+h:"&"+h,f(a,g)}};return g}(),h=function(){return{callback:function(){},events:[]}},i=function(){var a=[],b=h(),c=!1,d=!1,e=null,i=!1,j={useXHR:!0,start:function(){d||(d=!0,e=setInterval(function(){j.sendNext()},1e3))},stop:function(){d&&(d=!1,clearTimeout(e))},isRunning:function(){return d===!0},setRequestMethod:function(a){this.useXHR="xhr"===a},length:function(){return a.length},isEmpty:function(){return 0===a.length},isSending:function(){return c===!0},startGroup:function(){i=!0},endGroup:function(){var a=b;i=!1,0!==b.events.length&&(b=h(),this.add(a.events,a.callback))},isGroup:function(){return i},add:function(c,d){if(i){if(d){var e=b.callback;b.callback=function(){d.apply(this,arguments),e.apply(this,arguments)}}b.events[b.events.length]=c}else a[a.length]={event:c,callback:d},this.sendNext()},sendNext:function(){if(d&&!c&&!this.isEmpty()){c=!0;var b=a[0],e=(JSON.stringify({p:b.event}),this),h=I.getEndpoint(),i={p:b.event},j=function(){a.shift(),c=!1,e.sendNext()},k=function(){c=!1};this.useXHR?f.send(h,i,j,k):g.send(h,i,j,k)}}};return j.start(),j}(),j=function(){var a=location.protocol||"https:";return"http:"!==a&&"https:"!==a&&(a="http:"),a},k=j()+"//events.psiori.com/sample/v01/event",l="Sample.JS",m="0.0.2",n=null,o=null,p=null,q=null,r=null,s=null,t=null,u=null,v=null,w=null,x=null,y=null,z=null,A=null,B=null,C=null,D=null,E=!0,F=!1,G=function(b,c,d){var e={},f=function(a,b){a&&"undefined"!=typeof b&&("number"==typeof b||b)&&(e[a]=b)};return f("sdk",l),f("sdk_event",m),f("platform",b.platform||t),f("client",b.client||u),f("client_version",b.client_version||v),f("event_name",c),f("app_token",o),f("install_token",n),f("session_token",p),f("debug",F),f("timestamp",Math.round((new Date).getTime()/1e3)),f("user_id",r),f("event_category",d||"custom"),f("module",b.module||q),f("content_id",b.content_id),f("content_ids",b.content_ids),f("content_type",b.content_type),f("parameter1",b.parameter1),f("parameter2",b.parameter2),f("parameter3",b.parameter3),f("parameter4",b.parameter4),f("parameter5",b.parameter5),f("parameter6",b.parameter6),("purchase"===c||"chargeback"===c)&&(f("provider",b.provider),f("gross",b.gross),f("currency",b.currency),f("country",b.country),f("earnings",b.earnings),f("product_sku",b.product_sku),f("product_category",b.product_category),f("receipt_identifier",b.receipt_identifier)),("session_start"===c||"session_update"===c||d&&"account"===d)&&(f("email",b.email||s),f("locale",b.locale||B),f("ad_referer",b.ad_referer||y),f("ad_campaign",b.ad_campaign||z),f("ad_placement",b.ad_placement||A),f("longitute",b.longitude||w),f("latitude",b.latitude||x),E&&(f("http_referrer",document.referrer),f("http_request",a.location.href)),f("host",D||(E?a.location.host:null))),e},H=function(a){for(var b="",c=0;a>c;++c)c>0&&c%4===0&&(b+="-"),b+=Math.floor(16*Math.random()).toString(16).toUpperCase();return b},I={PLATFORM_BROWSER:"browser",PLATFORM_IOS:"ios",PLATFORM_ANDROID:"android",PLATFORM_WINDOWS:"windows",PLATFORM_FACEBOOK:"facebook",init:function(){localStorage.getItem("SampleToken")?n=localStorage.getItem("SampleToken"):localStorage.setItem("SampleToken",n=H(24)),sessionStorage.getItem("SampleToken")?p=sessionStorage.getItem("SampleToken"):sessionStorage.setItem("SampleToken",p=H(32)),t=this.PLATFORM_BROWSER,i.setRequestMethod(this.isWebkit()?"xhr":"iframe")},stop:function(){i.stop()},resume:function(){i.start()},setEndpoint:function(a){k=a},getEndpoint:function(){return k},setRequestMethod:function(a){i.setRequestMethod(a)},setAppToken:function(a){o=a},setModule:function(a){q=a},setPlatform:function(a){t=a},setClient:function(a){u=a},setClientVersion:function(a){v=a},setUserId:function(a){r=a},setFacebookId:function(a){facebookId=a},setEmail:function(a){s=a},setLocation:function(a,b){w=newLogitude,x=b},setLocale:function(a){B=a},setReferer:function(a,b,c){y=a||null,z=b||null,A=c||null},setDebug:function(a){F=a},setBrowserMode:function(a){inBrowser=!!a},setHost:function(a){D=a},startGroup:function(){i.startGroup()},endGroup:function(){i.endGroup()},track:function(a,b,c){c=G(c||{},a,b),i.add(c,function(){})},sessionStart:function(a,b,c){o=a||o,r=b||r,this.track("session_start","session",c)},sessionUpdate:function(a){this.track("session_update","session",a)},sessionPause:function(){this.track("session_pause","session")},sessionResume:function(){this.track("session_resume","session")},ping:function(){this.track("ping","session")},autoPing:function(a){var b=this;"undefined"==typeof a&&(a=60),clearTimeout(C),C=null,a&&a>0&&(C=setInterval(function(){b.ping()},1e3*a))},registration:function(a,b){r=a||r,this.track("registration","account",b)},signIn:function(a,b){r=a||r,this.track("sign_in","account",b)},contentUsage:function(a,c){c=c||"content";var d={content_type:c};b(a)?d.content_ids=a:d.content_id=a,this.track("usage","content",d)},purchase:function(a,b){var c=b||{};c.product_sku=a,this.track("purchase","revenue",c)},chargeback:function(a,b){var c=b||{};c.product_sku=a,this.track("chargeback","revenue",c)},isWebkit:function(){var a=null;return function(){if(null===a){var b=navigator.userAgent.toLowerCase();a=-1!==b.indexOf("safari")||-1!==b.indexOf("chrome")}return a}}(),isIE:function(){var a=null;return function(){if(null===a){var b=navigator.userAgent;a=-1!==b.indexOf("MSIE")||b.indexOf("Trident/")>0}return a}}()};I.init(),a.Sample=I}(window);
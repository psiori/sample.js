/*!
 * Sample.js - Sends tracking events to 5d's analytics service. v0.0.1
 * http://www.5dlab.com
 *
 * Copyright (c) 2014-2014, Sascha Lange, JoÃ£o Alves
 * Licensed under the MIT License.
 *
 */

!function(a){var b=function(){var a=[],b=!1,c=!1,d=null,e={start:function(){c||(c=!0,d=setTimeout(function(){e.sendNext()},1e3))},stop:function(){c&&(c=!1,clearTimeout(d))},isRunning:function(){return c===!0},length:function(){return a.length},isEmpty:function(){return 0===a.length},isSending:function(){return b===!0},add:function(b,c){a[a.length]={event:b,callback:c},this.sendNext()},sendNext:function(){if(c&&!b&&!this.isEmpty()){b=!0;var d=a[0],e=JSON.stringify({p:d.event}),f=this,g=new XMLHttpRequest;g.addEventListener("load",function(){a.shift(),b=!1,f.sendNext()},!0),g.addEventListener("error",function(){b=!1}),g.open("POST",j.getEndpoint()),g.setRequestHeader("Content-type","application/json; charset=utf-8"),g.setRequestHeader("Content-length",e.length),g.setRequestHeader("Connection","close"),g.send(e)}}};return e.start(),e}(),c="http://events.neurometry.com/sample/v01/event",d=null,e=null,f=null,g=null,h=function(a,b){return a.event_name=b,a.app_token=e,a.install_token=d,a.session_token=f,g&&(a.module=a.module||g),a},i=function(a){for(var b="",c=0;a>c;++c)c>0&&c%4===0&&(b+="-"),b+=Math.floor(16*Math.random()).toString(16).toUpperCase();return b},j={safariOnly:!1,init:function(){localStorage.SampleToken?d=localStorage.SampleToken:localStorage.SampleToken=d=i(24),sessionStorage.SampleToken?f=sessionStorage.SampleToken:sessionStorage.SampleToken=f=i(32)},setEndpoint:function(a){c=a},getEndpoint:function(){return c},setAppToken:function(a){e=a},setModule:function(){g=g},track:function(a,c){(this.safariOnly!==!0||this.isSafari())&&(c=h(c||{}),b.add(c,function(){}))},sessionStart:function(){e=newAppToken||e,this.track("session_start",{category:"session"})},sessionUpdate:function(){this.track("session_update",{category:"session"})},ping:function(){this.track("ping",{category:"session"})},isSafari:function(){var a=null;return function(){if(null===a){var b=navigator.userAgent.toLowerCase();a=-1!=b.indexOf("safari")?b.indexOf("chrome")>-1?!1:!0:!1}return a}}()};j.init(),a.Sample=j}(window);
/*!
 * Sample.js - Sends tracking events to 5d's analytics service. v0.0.1
 * http://www.5dlab.com
 *
 * Copyright (c) 2014-2014, Sascha Lange, JoÃ£o Alves
 * Licensed under the MIT License.
 *
 */

!function(a){var b=function(){var a=[],b=!1,c=!1,d=null,e={start:function(){c||(c=!0,d=setTimeout(function(){e.sendNext()},1e3))},stop:function(){c&&(c=!1,clearTimeout(d))},isRunning:function(){return c===!0},length:function(){return a.length},isEmpty:function(){return 0===a.length},isSending:function(){return b===!0},add:function(b,c){a[a.length]={event:b,callback:c},this.sendNext()},sendNext:function(){if(c&&!b&&!this.isEmpty()){b=!0;var d=a[0],e=JSON.stringify({p:d.event}),f=this,g=new XMLHttpRequest;g.addEventListener("load",function(){a.shift(),b=!1,f.sendNext()},!0),g.addEventListener("error",function(){b=!1}),g.open("POST",k.getEndpoint()),g.setRequestHeader("Content-type","application/json; charset=utf-8"),g.setRequestHeader("Content-length",e.length),g.setRequestHeader("Connection","close"),g.send(e)}}};return e.start(),e}(),c="http://events.neurometry.com/sample/v01/event",d=null,e=null,f=null,g=null,h=!1,i=function(a,b){var c={},i=function(a,b){a&&"undefined"!=typeof b&&("number"==typeof b||b)&&(c[a]=b)};return i("event_name",b),i("app_token",e),i("install_token",d),i("session_token",f),i("event_category",a.event_category),i("module",a.module||g),i("debug",h),i("timestamp",Math.round((new Date).getTime()/1e3)),c},j=function(a){for(var b="",c=0;a>c;++c)c>0&&c%4===0&&(b+="-"),b+=Math.floor(16*Math.random()).toString(16).toUpperCase();return b},k={safariOnly:!1,init:function(){localStorage.SampleToken?d=localStorage.SampleToken:localStorage.SampleToken=d=j(24),sessionStorage.SampleToken?f=sessionStorage.SampleToken:sessionStorage.SampleToken=f=j(32)},setEndpoint:function(a){c=a},getEndpoint:function(){return c},setAppToken:function(a){e=a},setModule:function(a){g=a},setDebug:function(a){h=a},track:function(a,c){(this.safariOnly!==!0||this.isSafari())&&(c=i(c||{},a),b.add(c,function(){}))},sessionStart:function(a){e=a||e,this.track("session_start",{event_category:"session"})},sessionUpdate:function(){this.track("session_update",{event_category:"session"})},ping:function(){this.track("ping",{event_category:"session"})},isSafari:function(){var a=null;return function(){if(null===a){var b=navigator.userAgent.toLowerCase();a=-1!=b.indexOf("safari")?b.indexOf("chrome")>-1?!1:!0:!1}return a}}()};k.init(),a.Sample=k}(window);